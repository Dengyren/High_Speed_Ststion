@model IEnumerable<DAL.View_UserInfo>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}




<style type="text/css">
    .mylabel {
        font-size: large;
        font-weight: bold;
        padding: 0;
        width: 5em;
        margin-bottom: 0px;
        margin-left: 7em;
    }
</style>


<div class="modal fade" id="queryInfo1" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalTitle">修改密码</h4>
            </div>
            <div class="modal-body">
                <div class="input-group" id="old">
                    <span class="input-group-addon">原密码</span>
                    <input type="password" class="form-control my_input"
                           id="Oldpwd" data-toggle="popover"
                           data-content="密码错误"
                           data-placement="bottom">
                </div>
                <div class="input-group" id="new" style="display:none">
                    <span class="input-group-addon">新&nbsp;&nbsp;密&nbsp;&nbsp;码</span>
                    <input type="password" class="form-control"
                           id="Newpwd">
                </div>
                <div class="input-group" id="_new" style="display:none">
                    <span class="input-group-addon">确认密码</span>
                    <input type="password" class="form-control"
                           id="_Newpwd" data-toggle="popover"
                           data-content="两次输入的密码不相同"
                           data-placement="bottom">
                </div>
                <div class="modal-footer">

                    <button type="submit" class="btn btn-success" id="btn_edit" value="1">确定</button>
                    <button type="button" class="btn btn-default" id="myclose"
                            data-dismiss="modal">
                        关闭
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal -->
    </div>
</div>


<div class="modal fade" id="queryInfo2" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalTitle">修改基本信息</h4>
            </div>
            <div class="modal-body">
                <div class="input-group" id="model1">
                    <span class="input-group-addon">&nbsp;&nbsp;姓&nbsp;&nbsp;&nbsp;&nbsp;名&nbsp;&nbsp;</span>
                    <input type="text" class="form-control my_input"
                           id="input1" data-toggle="popover"
                           data-content="不能为空"
                           data-placement="bottom">
                </div>
                <br />
                <div class="input-group" id="model2">
                    <span class="input-group-addon">&nbsp;&nbsp;籍&nbsp;&nbsp;&nbsp;&nbsp;贯&nbsp;&nbsp;</span>
                    <input type="text" class="form-control"
                           id="input2" data-toggle="popover"
                           data-content="不能为空"
                           data-placement="bottom">
                </div>
                <br />
                <div class="input-group" id="model3">
                    <span class="input-group-addon">手机号码</span>
                    <input type="text" class="form-control"
                           id="input3" data-toggle="popover"
                           data-content="不能为空"
                           data-placement="bottom">
                </div>
                <div class="input-group" id="model3" style=" display:none">
                    <input type="text" class="form-control"
                           id="input4">
                </div>
                <br />
                <div class="input-group" id="model3">
                    <span class="input-group-addon">身份证照片</span>
                    <div class="col-sm-8 col-md-7">
                        <div class="thumbnail">
                            <img src="" id="photo" alt="用户身份证图片"
                                 style="width:320px;height:130px">
                            <div style="display:inline-block">
                                <input type="button" name="submit" id="btn_import" class="btn btn-warning" value="更换" style="margin-left:300px">
                                <div class="container kv-main" hidden>
                                    <br>
                                    <form enctype="multipart/form-data">
                                        <div class="form-group">
                                            <input id="file" type="file" multiple class="file-loading" name="file">
                                        </div>
                                    </form>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="modal-footer">

                    <button type="submit" class="btn btn-success" id="btn_Info" value="1">提交</button>
                    <button type="button" class="btn btn-default" id="myclose"
                            data-dismiss="modal">
                        关闭
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal -->
    </div>
</div>


<div class="col-md-12 col-sm-12 col-xs-12">
    <div class="panel panel-default" style="margin-top: 60px;margin-right:30px;margin-left:20px">
        <h1 class="panel-heading" style="background-color:white">车主信息</h1>
        <div class="clearfix"></div>
    </div>
</div>


<div class="col-md-12 col-sm-12 col-xs-12">
    <div class="panel panel-default" style="margin-top: 20px;margin-right:30px;margin-left:20px">
        <label class="control-label col-sm-1 mylabel" for="txt_search_statu" style="font-size:18px; margin-top: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;姓名</label>
        <div class="col-sm-4">
            <input id="name" name="name" type="text" readonly="readonly" class="form-control fl re-search" style="background-color:white; text-align: center;font-size: large; font-weight: bold;" />
        </div>

        <label class="control-label col-sm-1 mylabel" for="txt_search_statu" style="font-size:18px; margin-top: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;籍贯</label>
        <div class="col-sm-4">
            <input id="place" name="place" type="text" readonly="readonly" class="form-control fl re-search" style="background-color:white; text-align: center;font-size: large; font-weight: bold;" />
        </div>
        <br />
        <br />
        <br />
        <br />
        <label class="control-label col-sm-2 mylabel" for="txt_search_statu" style="font-size:18px; margin-top: 5px;">&nbsp;&nbsp;&nbsp;手机号码</label>
        <div class="col-sm-4">
            <input id="tel" name="tel" type="text" readonly="readonly" class="form-control fl re-search " style="background-color:white; text-align: center;font-size: large; font-weight: bold;" />
        </div>

        <label class="control-label col-sm-1 mylabel" for="txt_search_statu" style="font-size:18px; margin-top: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;密码</label>
        <div class="col-sm-4">
            <input id="pwd" name="pwd" type="text" readonly="readonly" class="form-control fl re-search" style="background-color:white; text-align: center;font-size: large; font-weight: bold;" />
        </div>
        <br />
        <br />
        <br />
        <br />
        <label class="control-label col-sm-2 mylabel" for="txt_search_statu" style="font-size:18px; margin-top: 5px;">身份证号码</label>
        <div class="col-sm-4">
            <input id="IDCard" name="IDCard" type="text" readonly="readonly" class="form-control fl re-search" style="background-color:white; text-align: center;font-size: large; font-weight: bold;" />
        </div>

        <label class="control-label col-sm-1 mylabel" mylabel for="txt_search_statu" style="font-size:18px; margin-top: 5px;">驾驶证号码</label>
        <div class="col-sm-4">
            <input id="DriverID" name="DriverID" type="text" readonly="readonly" class="form-control fl re-search" style="background-color:white;text-align: center;font-size: large; font-weight: bold;" />
        </div>
        <br />
        <br />
        <br />
        <br />
        <label class="control-label col-sm-1 mylabel" for="txt_search_statu" style="font-size:18px; margin-top: 5px;">身份证照片</label>
        <div class="controls" style="margin-left:6.5em">
            <a class="thumbnail" style="width:40%;height:40%;margin-left:10%">
                <img src="" class="img-responsive" style="width:50%;height:200px">
            </a>
        </div>





        <div class="row  clearfix">
            <div class="span10 offset2" style="text-align:right;margin-right:10%">
                <input type="button" name="submit" id="my_btn" class="btn btn-danger" value="修改密码" style="margin-left: 200px" ; data-toggle="tooltip" data-placement="left" title="修改密码">
                <input type="button" name="submit" id="my_Info" class="btn btn-warning" value="修改基本信息" data-toggle="tooltip" data-placement="top" title="不包含车牌信息">
                <input type="button" name="submit" id="my_submit" class="btn btn-primary" value="提交审核" data-toggle="tooltip" data-placement="top" title="信息修改后应提交审核">
            </div>
        </div>

    </div>

</div>



<div class="modal fade" id="queryInfo3" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">
                    &times;
                </button>
                <h3 class="modal-title" id="myModalTitle">未提交审核信息</h3>
            </div>
            <div class="modal-body">
                <form id="defaultForm" class="form-horizontal">
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="margin-top:0">姓名：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="examine_input2" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">籍贯：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="examine_input5" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="margin-top:0">手机号码：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="examine_input6" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">驾驶证号码：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="examine_input4" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" style="margin-top:0">身份证号码：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="examine_input1" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">用户身份证照片：</label>
                        <div class="col-sm-3">
                            <img src="" id="examine_input3" class="img-thumbnai" alt="用户身份证照片" width="180" height="80">
                        </div>
                    </div>

                    <div class="form-group" id="car0" style="display:none">
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌1：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="car_input0" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌照片：</label>
                        <div class="col-sm-5">
                            <img src="" id="car_f0" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                            <img src="" id="car_b0" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                        </div>
                    </div>
                    <div class="form-group" id="car1" style="display:none">
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌2：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="car_input1" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌照片：</label>
                        <div class="col-sm-5">
                            <img src="" id="car_f1" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                            <img src="" id="car_b1" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                        </div>
                    </div>
                    <div class="form-group" id="car2" style="display:none">
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌3：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="car_input2" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌照片：</label>
                        <div class="col-sm-5">
                            <img src="" id="car_f2" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                            <img src="" id="car_b2" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                        </div>
                    </div>
                    <div class="form-group" id="car3" style="display:none">
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌4：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="car_input3" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌照片：</label>
                        <div class="col-sm-5">
                            <img src="" id="car_f3" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                            <img src="" id="car_b3" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                        </div>
                    </div>
                    <div class="form-group" id="car4" style="display:none">
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌5：</label>
                        <div class="col-sm-3">
                            <input class="form-control" id="car_input4" type="text" readonly="readonly" style="background-color:white" />
                        </div>
                        <label class="col-sm-2 control-label" style="margin-top:0">车牌照片：</label>
                        <div class="col-sm-5">
                            <img src="" id="car_f4" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                            <img src="" id="car_b4" class="img-thumbnail" alt="车牌照片" width="160" height="80">
                        </div>
                    </div>
                </form>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" id="btn_examine" value="1">提交审核</button>
                    <button type="button" class="btn btn-default" id="myclose" data-dismiss="modal"> 关闭</button>
                </div>

            </div>
        </div>


        <!-- /.modal-content -->
    </div>
    <!-- /.modal -->
</div>



<script>
    $(document).ready(function () {




        //显示个人信息
        $(function () {
            toastr.options = {
                "closeButton": false,
                "debug": false,
                "postitionClass": "toast-top-full-width",
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };

            $("[data-toggle='tooltip']").tooltip();
            $.ajax({
                type: "POST",//请求方式
                url: '/UserInfo/View_UserInfo/GetMessage',
                dataType: "json",
                success: function (data) {
                    if (data.身份证号码 == null) {
                        window.location.replace("/UserInfo/View_UserInfo/Create");
                    }
                    $("#name").val(data.姓名);
                    $("#place").val(data.籍贯);
                    $("#tel").val(data.手机号码);
                    $("#pwd").val("******");
                    $("#IDCard").val(data.身份证号码);
                    $("#DriverID").val(data.驾驶证号码);
                    $(".img-responsive").attr("src", data.身份证照片 + '?' + Math.random());
                }
            });
        });


        $("#btn_edit").click(function () {
            if (document.all.btn_edit.value == 1) {
                $.ajax({
                    type: "POST",//请求方式
                    url: '/UserInfo/View_UserInfo/Checkpwd',
                    dataType: "json",
                    data: {
                        "pwd": $("#Oldpwd").val(),
                    },
                    success: function (data) {
                        if (data) {
                            $("#old").hide();
                            $("#new").show();
                            $("#_new").show();
                            document.all.btn_edit.value = "2";
                        }
                        else {
                            $('#Oldpwd').popover('show');
                            $('#Oldpwd').popover();
                            var t = setTimeout("$('#Oldpwd').popover('destroy');", 3000);
                            $("#old").addClass("has-warning");
                        }
                    }
                });
            }
            else if (document.all.btn_edit.value == 2 && $("#Newpwd").val() == $("#_Newpwd").val()) {
                $.ajax({
                    type: "POST",//请求方式
                    url: '/UserInfo/View_UserInfo/Edit_pwd',
                    dataType: "json",
                    data: {
                        "pwd": $("#Newpwd").val(),
                    },
                    success: function (data) {
                        if (data) {
                            $('#queryInfo1').modal('hide');
                            toastr.success("修改成功");
                            $("#new").hide();
                            $("#old").show();
                            $("#_new").hide();
                            document.all.btn_edit.value = "1";
                            $("#old").removeClass("has-warning");
                            $("#new").removeClass("has-warning");
                            $("#_new").removeClass("has-warning");
                            $("#Oldpwd").val("");
                            $("#Newpwd").val("");
                            $("#_Newpwd").val("");
                        }

                    }
                });
            }
            else if ($("#Newpwd").val() != $("#_Newpwd").val()) {
                $('#_Newpwd').popover('show');
                $('#_Newpwd').popover();
                var t = setTimeout("$('#Oldpwd').popover('destroy');", 3000);
                $("#new").addClass("has-warning");
                $("#_new").addClass("has-warning");
                return false;
            }
        });
        $("#myclose").click(function () {
            for (var r = 1; i <= 5; i++)
                $("#car" + r).hide();
        });


        $("#my_submit").click(function () {
            var carCount = 0;
            $.ajax({
                type: "POST",//请求方式
                url: '/UserInfo/View_UserInfo/GetExamineMsg',
                dataType: "json",
                data: {
                },
                success: function (data) {
                    for (var value1 in data) {
                        var item = value1;
                        var key1 = data[value1];//data.view_user
                        for (var value2 in key1) {
                            var num = value2;
                            var n = 1;
                            var key2 = key1[value2];//data.view_user[0]
                            for (var key in key2) {
                                var value = key2[key];//data.view_user[0].姓名
                                if (item == "view_user") {
                                    if (n == 3) {
                                        $("#examine_input" + n).attr("src", value + '?' + Math.random());
                                    }
                                    else
                                        $("#examine_input" + n).val(value);
                                    n++;
                                }
                                else {

                                    if (n == 2)
                                        $("#car_input" + num).val(value);
                                    else if (n == 5)
                                        $("#car_f" + num).attr("src", value + '?' + Math.random());
                                    else if (n == 6) {
                                        $("#car_b" + num).attr("src", value + '?' + Math.random());
                                        $("#car" + num).show();
                                        carCount++;
                                    }
                                    n++;
                                }
                            }
                        }
                    }
                    if (carCount > 0)
                        $('#queryInfo3').modal('show');
                    else { toastr.error("没有未提交审核的车辆"); }
                }
            });
        });

        $("#my_btn").click(function () {
            document.all.btn_edit.value = "1";
            $("#new").hide();
            $("#old").show();
            $("#_new").hide();
            $("#old").removeClass("has-warning");
            $("#new").removeClass("has-warning");
            $("#_new").removeClass("has-warning");
            $("#Oldpwd").val("");
            $("#Newpwd").val("");
            $("#_Newpwd").val("");
            $('#Oldpwd').popover('destroy');
            $('#_Newpwd').popover('destroy');
            $('#queryInfo1').modal('show');
        });


        $("#my_Info").click(function () {
            for (var item = 1; item <= 3; item++) {
                $("#input" + item).val("");
                $("#model" + item).removeClass("has-warning");
                $("#model" + item).removeClass("has-success");
            }
            $('#queryInfo2').modal('show');
            $("#input1").val($("#name").val());
            $("#input2").val($("#place").val());
            $("#input3").val($("#tel").val());
            $("#input4").val($(".img-responsive")[0].src);
            $("#photo").attr("src", $(".img-responsive")[0].src);
        });





        $("#btn_import").click(function () {
            $("#file").click();
        });
        $("#file").fileinput({
            uploadUrl: '/UserInfo/View_UserInfo/Change_Import',
            allowedFileExtensions: ['jpg', 'png', 'gif'],
            maxFileSize: 10000,
            maxFilesNum: 1,
            language: 'zh',
            uploadExtraData: function () {//向后台传递参数
                var data = {
                    username: $("#input1").val(),
                };
                return data;
            },
        }).on("filebatchselected", function (event, files) {//选择文件后处理事件直接上传
            $("#file").fileinput("upload");
        }).on("fileuploaded", function (event, data, previewId, index) {
            $("#input4").val(data.response);
            $("#photo").attr("src", data.response);

        });



        $("#btn_Info").click(function () {
            var msg = {
                姓名: $("#input1").val(),
                手机号码: $("#input3").val(),
                籍贯: $("#input2").val(),
                身份证照片: $("#input4").val(),
            };
            var error = 0;
            for (var item = 1; item <= 3; item++) {
                var str = "#input" + item;
                if ($(str).val() == "") {
                    $("#model" + item).addClass("has-warning");
                    $(str).popover('show');
                    $(str).popover();
                    error++;
                }
                else {
                    $("#model" + item).removeClass("has-warning");
                    $("#model" + item).addClass("has-success");
                }
            }
            setTimeout("$('#input1').popover('destroy')", 3000);
            setTimeout("$('#input3').popover('destroy')", 3000);
            setTimeout("$('#input2').popover('destroy')", 3000);
            if (error == 0) {
                $.ajax({
                    type: "POST",//请求方式
                    url: '/UserInfo/View_UserInfo/NewEdit',
                    dataType: "json",
                    data: {
                        "msg": msg
                    },
                    success: function (data) {
                        $(".img-responsive").attr("src", data);
                        $('#queryInfo2').modal('hide');
                        parent.location.reload();
                    }
                });
            }
            else {
                return false;
            }
        });


        $("#btn_examine").click(function () {
            $.ajax({
                type: "POST",//请求方式
                url: '/UserInfo/View_UserInfo/SendExamineMsg',
                dataType: "json",
                data: {
                },
                success: function (data) {
                    $('#queryInfo3').modal('hide');
                    toastr.success("提交成功");
                    for (var i = 0; i < 5; i++) {
                        $("#car" + i).hide();
                    }
                }
            });

        });

    });
</script>
